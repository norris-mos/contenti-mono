{"ast":null,"code":"import _regeneratorRuntime from \"/Users/maxoliverstapyltonnorris/H5P-Nodejs-library/packages/h5p-rest-example-client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/maxoliverstapyltonnorris/H5P-Nodejs-library/packages/h5p-rest-example-client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _classCallCheck from \"/Users/maxoliverstapyltonnorris/H5P-Nodejs-library/packages/h5p-rest-example-client/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/maxoliverstapyltonnorris/H5P-Nodejs-library/packages/h5p-rest-example-client/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _inherits from \"/Users/maxoliverstapyltonnorris/H5P-Nodejs-library/packages/h5p-rest-example-client/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/Users/maxoliverstapyltonnorris/H5P-Nodejs-library/packages/h5p-rest-example-client/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport * as React from 'react';\nimport { Component, createRef } from 'react';\nimport { defineElements } from '@lumieducation/h5p-webcomponents';\ndefineElements('h5p-editor');\nvar H5PEditorUI = /*#__PURE__*/function (_Component) {\n  _inherits(H5PEditorUI, _Component);\n  var _super = _createSuper(H5PEditorUI);\n  function H5PEditorUI(props) {\n    var _this;\n    _classCallCheck(this, H5PEditorUI);\n    _this = _super.call(this, props);\n    _this.loadContentCallbackWrapper = function (contentId) {\n      return _this.props.loadContentCallback(contentId);\n    };\n    _this.onEditorLoaded = function (event) {\n      if (_this.props.onLoaded) {\n        _this.props.onLoaded(event.detail.contentId, event.detail.ubername);\n      }\n    };\n    _this.onSaved = function (event) {\n      if (_this.props.onSaved) {\n        _this.props.onSaved(event.detail.contentId, event.detail.metadata);\n      }\n    };\n    _this.onSaveError = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(event) {\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              if (_this.props.onSaveError) {\n                _this.props.onSaveError(event.detail.message);\n              }\n            case 1:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee);\n      }));\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n    _this.saveContentCallbackWrapper = function (contentId, requestBody) {\n      return _this.props.saveContentCallback(contentId, requestBody);\n    };\n    _this.h5pEditor = createRef();\n    return _this;\n  }\n  _createClass(H5PEditorUI, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.registerEvents();\n      this.setServiceCallbacks();\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      var _a;\n      this.registerEvents();\n      this.setServiceCallbacks();\n      (_a = this.h5pEditor.current) === null || _a === void 0 ? void 0 : _a.resize();\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.unregisterEvents();\n    }\n  }, {\n    key: \"getSnapshotBeforeUpdate\",\n    value: function getSnapshotBeforeUpdate() {\n      // Should the old editor instance be destroyed, we unregister from it...\n      this.unregisterEvents();\n      return null;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(\"h5p-editor\", {\n        ref: this.h5pEditor,\n        \"content-id\": this.props.contentId\n      });\n    }\n    /**\n     * Call this method to save the current state of the h5p editor. This will\n     * result in a call to the `saveContentCallback` that was passed in the\n     * through the props.\n     * @throws an error if there was a problem (e.g. validation error of the\n     * content)\n     */\n  }, {\n    key: \"save\",\n    value: function () {\n      var _save = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var _a;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              _context2.next = 3;\n              return (_a = this.h5pEditor.current) === null || _a === void 0 ? void 0 : _a.save();\n            case 3:\n              return _context2.abrupt(\"return\", _context2.sent);\n            case 6:\n              _context2.prev = 6;\n              _context2.t0 = _context2[\"catch\"](0);\n            case 8:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, this, [[0, 6]]);\n      }));\n      function save() {\n        return _save.apply(this, arguments);\n      }\n      return save;\n    }()\n  }, {\n    key: \"registerEvents\",\n    value: function registerEvents() {\n      var _a, _b, _c, _d;\n      (_a = this.h5pEditor.current) === null || _a === void 0 ? void 0 : _a.addEventListener('saved', this.onSaved);\n      (_b = this.h5pEditor.current) === null || _b === void 0 ? void 0 : _b.addEventListener('editorloaded', this.onEditorLoaded);\n      (_c = this.h5pEditor.current) === null || _c === void 0 ? void 0 : _c.addEventListener('save-error', this.onSaveError);\n      (_d = this.h5pEditor.current) === null || _d === void 0 ? void 0 : _d.addEventListener('validation-error', this.onSaveError);\n    }\n  }, {\n    key: \"setServiceCallbacks\",\n    value: function setServiceCallbacks() {\n      if (this.h5pEditor.current) {\n        this.h5pEditor.current.loadContentCallback = this.loadContentCallbackWrapper;\n        this.h5pEditor.current.saveContentCallback = this.saveContentCallbackWrapper;\n      }\n    }\n  }, {\n    key: \"unregisterEvents\",\n    value: function unregisterEvents() {\n      var _a, _b, _c, _d;\n      (_a = this.h5pEditor.current) === null || _a === void 0 ? void 0 : _a.removeEventListener('saved', this.onSaved);\n      (_b = this.h5pEditor.current) === null || _b === void 0 ? void 0 : _b.removeEventListener('editorloaded', this.onEditorLoaded);\n      (_c = this.h5pEditor.current) === null || _c === void 0 ? void 0 : _c.removeEventListener('save-error', this.onSaveError);\n      (_d = this.h5pEditor.current) === null || _d === void 0 ? void 0 : _d.removeEventListener('validation-error', this.onSaveError);\n    }\n  }]);\n  return H5PEditorUI;\n}(Component);\nexport { H5PEditorUI as default };","map":{"version":3,"names":["React","Component","createRef","defineElements","H5PEditorUI","_Component","_inherits","_super","_createSuper","props","_this","_classCallCheck","call","loadContentCallbackWrapper","contentId","loadContentCallback","onEditorLoaded","event","onLoaded","detail","ubername","onSaved","metadata","onSaveError","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","message","stop","_x","apply","arguments","saveContentCallbackWrapper","requestBody","saveContentCallback","h5pEditor","_createClass","key","value","componentDidMount","registerEvents","setServiceCallbacks","componentDidUpdate","_a","current","resize","componentWillUnmount","unregisterEvents","getSnapshotBeforeUpdate","render","createElement","ref","_save","_callee2","_callee2$","_context2","save","abrupt","sent","t0","addEventListener","_b","_c","_d","removeEventListener","default"],"sources":["/Users/maxoliverstapyltonnorris/H5P-Nodejs-library/packages/h5p-react/src/H5PEditorUI.tsx"],"sourcesContent":["import * as React from 'react';\nimport { Component, createRef, ReactNode, RefObject } from 'react';\n\nimport {\n    defineElements,\n    H5PEditorComponent as H5PEditorWebComponent\n} from '@lumieducation/h5p-webcomponents';\nimport type { IContentMetadata, IEditorModel } from '@lumieducation/h5p-server';\n\ndefineElements('h5p-editor');\n\ndeclare global {\n    /**\n     * Enables type checks for JSX.\n     */\n    namespace JSX {\n        interface IntrinsicElements {\n            'h5p-editor': {\n                'content-id'?: string;\n                'h5p-url'?: string;\n                ref?: any;\n            };\n        }\n    }\n}\n\ninterface IH5PEditorUIProps {\n    contentId: string;\n    loadContentCallback: (contentId: string) => Promise<\n        IEditorModel & {\n            library?: string;\n            metadata?: IContentMetadata;\n            params?: any;\n        }\n    >;\n    onLoaded?: (contentId: string, ubername: string) => void;\n    onSaved?: (contentId: string, metadata: IContentMetadata) => void;\n    onSaveError?: (errorMessage: string) => void;\n    saveContentCallback: (\n        contentId: string,\n        requestBody: {\n            library: string;\n            params: any;\n        }\n    ) => Promise<{\n        contentId: string;\n        metadata: IContentMetadata;\n    }>;\n}\n\nexport default class H5PEditorUI extends Component<IH5PEditorUIProps> {\n    constructor(props: IH5PEditorUIProps) {\n        super(props);\n        this.h5pEditor = createRef();\n    }\n\n    private h5pEditor: RefObject<H5PEditorWebComponent>;\n\n    public componentDidMount(): void {\n        this.registerEvents();\n        this.setServiceCallbacks();\n    }\n\n    public componentDidUpdate(): void {\n        this.registerEvents();\n        this.setServiceCallbacks();\n        this.h5pEditor.current?.resize();\n    }\n\n    public componentWillUnmount(): void {\n        this.unregisterEvents();\n    }\n\n    public getSnapshotBeforeUpdate(): void {\n        // Should the old editor instance be destroyed, we unregister from it...\n        this.unregisterEvents();\n        return null;\n    }\n\n    public render(): ReactNode {\n        return (\n            <h5p-editor\n                ref={this.h5pEditor}\n                content-id={this.props.contentId}\n            ></h5p-editor>\n        );\n    }\n\n    /**\n     * Call this method to save the current state of the h5p editor. This will\n     * result in a call to the `saveContentCallback` that was passed in the\n     * through the props.\n     * @throws an error if there was a problem (e.g. validation error of the\n     * content)\n     */\n    public async save(): Promise<\n        | {\n              contentId: string;\n              metadata: IContentMetadata;\n          }\n        | undefined\n    > {\n        try {\n            return await this.h5pEditor.current?.save();\n        } catch (error) {\n            // We ignore the error, as we subscribe to the 'save-error' and\n            // 'validation-error' events.\n        }\n    }\n\n    private loadContentCallbackWrapper = (\n        contentId: string\n    ): Promise<\n        IEditorModel & {\n            library?: string;\n            metadata?: IContentMetadata;\n            params?: any;\n        }\n    > => {\n        return this.props.loadContentCallback(contentId);\n    };\n\n    private onEditorLoaded = (\n        event: CustomEvent<{ contentId: string; ubername: string }>\n    ): void => {\n        if (this.props.onLoaded) {\n            this.props.onLoaded(event.detail.contentId, event.detail.ubername);\n        }\n    };\n\n    private onSaved = (\n        event: CustomEvent<{ contentId: string; metadata: IContentMetadata }>\n    ): void => {\n        if (this.props.onSaved) {\n            this.props.onSaved(event.detail.contentId, event.detail.metadata);\n        }\n    };\n\n    private onSaveError = async (\n        event: CustomEvent<{ message: string }>\n    ): Promise<void> => {\n        if (this.props.onSaveError) {\n            this.props.onSaveError(event.detail.message);\n        }\n    };\n\n    private registerEvents(): void {\n        this.h5pEditor.current?.addEventListener('saved', this.onSaved);\n        this.h5pEditor.current?.addEventListener(\n            'editorloaded',\n            this.onEditorLoaded\n        );\n        this.h5pEditor.current?.addEventListener(\n            'save-error',\n            this.onSaveError\n        );\n        this.h5pEditor.current?.addEventListener(\n            'validation-error',\n            this.onSaveError\n        );\n    }\n\n    private saveContentCallbackWrapper = (\n        contentId: string,\n        requestBody: {\n            library: string;\n            params: any;\n        }\n    ): Promise<{\n        contentId: string;\n        metadata: IContentMetadata;\n    }> => {\n        return this.props.saveContentCallback(contentId, requestBody);\n    };\n\n    private setServiceCallbacks(): void {\n        if (this.h5pEditor.current) {\n            this.h5pEditor.current.loadContentCallback =\n                this.loadContentCallbackWrapper;\n            this.h5pEditor.current.saveContentCallback =\n                this.saveContentCallbackWrapper;\n        }\n    }\n\n    private unregisterEvents(): void {\n        this.h5pEditor.current?.removeEventListener('saved', this.onSaved);\n        this.h5pEditor.current?.removeEventListener(\n            'editorloaded',\n            this.onEditorLoaded\n        );\n        this.h5pEditor.current?.removeEventListener(\n            'save-error',\n            this.onSaveError\n        );\n        this.h5pEditor.current?.removeEventListener(\n            'validation-error',\n            this.onSaveError\n        );\n    }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}